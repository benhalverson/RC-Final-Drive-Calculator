<div>
  <div class="flex items-center justify-between">
    <label for="car-preset" class="block text-sm/6 font-medium text-gray-900 dark:text-gray-300">Car preset</label>
    <button
      type="button"
      (click)="toggleSaveForm()"
      class="rounded-md px-2.5 py-1 text-xs font-medium text-indigo-700 ring-1 ring-inset ring-indigo-300 hover:bg-indigo-50 dark:text-indigo-300 dark:ring-indigo-600 dark:hover:bg-indigo-950"
      [class.bg-indigo-50]="showSaveForm()"
      [class.dark:bg-indigo-950]="showSaveForm()"
    >
      {{ showSaveForm() ? 'Cancel' : '+ Save preset' }}
    </button>
  </div>

  @if (showSaveForm()) {
    <div class="mt-2 flex gap-2">
      <input
        type="text"
        [value]="presetName()"
        (input)="presetName.set($any($event.target).value)"
        (keydown.enter)="onSavePreset()"
        (keydown.escape)="toggleSaveForm()"
        placeholder="Preset name..."
        class="flex-1 rounded-lg bg-white py-2 pl-3 pr-3 text-sm text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 dark:bg-gray-900 dark:text-gray-100 dark:ring-gray-600 dark:placeholder:text-gray-500 dark:focus-visible:ring-indigo-400"
        autofocus
      />
      <button
        type="button"
        (click)="onSavePreset()"
        [disabled]="!presetName().trim()"
        class="rounded-lg bg-indigo-600 px-3 py-2 text-sm font-medium text-white hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-indigo-500 dark:hover:bg-indigo-400"
      >
        Save
      </button>
    </div>
  }

  <div class="mt-2 relative">
    <select
      id="car-preset"
      name="car-preset"
      class="w-full appearance-none rounded-lg bg-white dark:bg-gray-900 py-2 pl-3 pr-14 text-base text-gray-900 dark:text-gray-100 ring-1 ring-inset ring-gray-300 dark:ring-gray-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 dark:focus-visible:ring-indigo-400 sm:text-sm"
      [value]="value()"
      (change)="onChange($event)"
    >
    @if (userPresets().length > 0) {
      <optgroup label="My Presets">
        @for (p of userPresets(); track p.id) {
          <option [value]="p.id">
            {{ p.name }} (S{{ p.spur }}/P{{ p.pinion }}/IR{{ p.internalRatio }})
          </option>
        }
      </optgroup>
    }
    <optgroup label="Touring Car">
      @for (p of tc(); track p.id) {
        <option [value]="p.id">
          {{ p.brand }} {{ p.model }} (IR {{ p.internalRatio }})
        </option>
      }
    </optgroup>

    <optgroup label="2WD Buggy">
      @for (p of buggy2wd(); track p.id) {
        <option [value]="p.id">
          {{ p.brand }} {{ p.model }} (IR {{ p.internalRatio }})
        </option>
      }
    </optgroup>

    <optgroup label="4WD Buggy">
      @for (p of buggy4wd(); track p.id) {
        <option [value]="p.id">
          {{ p.brand }} {{ p.model }} (IR {{ p.internalRatio }})
        </option>
      }
    </optgroup>
    </select>
    <svg viewBox="0 0 16 16" fill="currentColor" aria-hidden="true" class="pointer-events-none absolute inset-y-0 right-3 size-5 text-gray-400 dark:text-gray-500 sm:size-4">
      <path d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
    </svg>
  </div>

  @if (userPresets().length > 0 && value().startsWith('user:')) {
    <div class="mt-2">
      <button
        type="button"
        (click)="onRemovePreset(value(), $event)"
        class="text-xs text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300"
      >
        Delete this preset
      </button>
    </div>
  }
</div>

